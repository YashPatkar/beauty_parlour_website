{% extends 'base.html' %}
{% block title %}My Appointments - Beauty Parlour{% endblock %}
{% block content %}
<section class="py-5">
  <div class="container">
    <h1 class="mb-2">My Appointments</h1>
    <p class="text-muted mb-4">View and manage your bookings.</p>

    <!-- Upcoming -->
    <h2 class="h5 mb-3">Upcoming</h2>
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body">
        {% for appt in upcoming_appointments %}
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 py-3 border-bottom">
          <div>
            <h5 class="mb-1">{{ appt.service.name }}</h5>
            <p class="text-muted small mb-0">{{ appt.date }} at {{ appt.time }}{% if appt.staff %} · {{ appt.staff.name }}{% endif %}</p>
            <span class="badge bg-{% if appt.status == 'pending' %}warning{% elif appt.status == 'confirmed' %}success{% else %}secondary{% endif %} mt-1">{{ appt.get_status_display }}</span>
          </div>
          <div>
            {% if not appt.payment or appt.payment.status != 'paid' %}
            <a href="{% url 'payment' appt.id %}" class="btn btn-primary btn-sm">Pay Now</a>
            {% endif %}
            <a href="{% url 'cancel_appointment' appt.id %}" class="btn btn-outline-danger btn-sm" onclick="return confirm('Cancel this appointment?');">Cancel</a>
          </div>
        </div>
        {% empty %}
        <p class="text-muted mb-0">No upcoming appointments. <a href="{% url 'services_list' %}">Book a service</a>.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Booking history -->
    <h2 class="h5 mb-3">Booking history</h2>
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        {% for appt in past_appointments %}
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 py-3 border-bottom">
          <div>
            <h5 class="mb-1">{{ appt.service.name }}</h5>
            <p class="text-muted small mb-0">{{ appt.date }} at {{ appt.time }}{% if appt.staff %} · {{ appt.staff.name }}{% endif %}</p>
            <span class="badge bg-{% if appt.status == 'cancelled' %}danger{% elif appt.status == 'completed' %}success{% else %}secondary{% endif %} mt-1">{{ appt.get_status_display }}</span>
          </div>
        </div>
        {% empty %}
        <p class="text-muted mb-0">No past appointments yet.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
